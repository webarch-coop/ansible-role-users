---
- name: "The databases that {{ item.key }} has access to"
  command: mysql -B -N -e "SELECT Db FROM mysql.db WHERE User='test1';" mysql
  register: users_mariadb_list

- debug:
    msg: "Databases to be deleted for {{ item.key }}: {{ users_mariadb_list.stdout_lines }}"
    verbosity: 1

- name: "Databases absent for {{ item.key }}"
  mysql_db:
    name: "{{ db }}"
    state: absent
    login_user: root
    login_unix_socket: /var/run/mysqld/mysqld.sock
  loop: "{{ users_mariadb_list.stdout_lines }}"
  when: ( users_mariadb_list.stdout_lines is defined ) and ( users_mariadb_list.stdout_lines != [] )
  loop_control:
    loop_var: db

- name: "MariaDB user {{ item.key }} absent"
  mysql_user:
    name: "{{ item.key }}"
    state: absent
    login_user: root
    login_unix_socket: /var/run/mysqld/mysqld.sock
