---
# Test that users_domain resolves to a IP address

- name: Variable users_domain_ip set to empty
  set_fact:
    users_domain_ip: ""

- name: Set a fact for the domain we are testing
  set_fact:
    users_domain_ip: "{{ lookup('dig', '{{ users_domain }}') | ipv4 }}" 

- name: Print the IP address
  debug:
    msg: "{{ users_domain }} resolves to {{ users_domain_ip }}"

- name: "Fail if {{ users_domain_ip }} is not a IPv4 address" 
  fail:
    msg: "{{ users_domain }} appears not to resolve to a IP address"
  when: '"False" in users_domain_ip'
...
