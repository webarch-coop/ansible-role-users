# Ansible provisioned
# user: {{ item.key }}

# home: {{ item.value.users_home | default('/home/' + item.key) }}
{% for vhost,vhost_config in item.value.users_apache_virtual_hosts.items() %}

# {{ vhost }}
<VirtualHost *:80>
  ServerName {{ vhost_config.users_apache_server_name }}
{% if vhost_config.users_apache_server_aliases is defined %}
  ServerAlias{% for alias in vhost_config.users_apache_server_aliases %} {{ alias }}{% endfor %}
{% endif %}

{% if item.value.users_email is defined and item.value.users_email != "" %}
  ServerAdmin "{{ item.value.users_email }}"
{% endif %}

  DocumentRoot "{{ item.value.users_home | default('/home/' + item.key) }}/sites/{{ vhost }}"
  <Directory "{{ item.value.users_home | default('/home/' + item.key) }}/sites/{{ vhost }}">
  
  </Directory>

# {{ vhost_config.users_apache_template }}
</VirtualHost>
{% endfor %}


